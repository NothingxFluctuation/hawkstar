/*! updated; 09-05-2018 03:13 PM **/


Modulr.define("core.video:models/autoadvance",["require","jquery","lodash","helper","config","ISA"],function(require,$,_,Helper,config,ISA){function loadCustomPlaylist(url,playlistId,template){REQUEST_STACK[url]?REQUEST_STACK[url].done?template(REQUEST_STACK[url].data):REQUEST_STACK[url].fn.push(template):(REQUEST_STACK[url]={data:null,fn:[template],done:!1},playlistId?(url="//video.foxnews.com/v/feed/playlist/"+playlistId+".json?template=fox",REQUEST_STACK[url]={data:null,fn:[template],done:!1},$.ajax({url:url,dataType:"jsonp",jsonpCallback:"fxtartlis",cache:!0,success:function(data){var items=processCustomData(data);REQUEST_STACK[url].data=items,REQUEST_STACK[url].done=!0,triggerStack(url)}})):$.ajax({url:url,dataType:"jsonp",jsonpCallback:"fxtartlis",cache:!0,success:function(data){var items=processData(data);REQUEST_STACK[url].data=items,REQUEST_STACK[url].done=!0,triggerStack(url)}}))}function triggerStack(url){if(REQUEST_STACK[url])for(var data=REQUEST_STACK[url].data;REQUEST_STACK[url].fn.length>0;){var fn=REQUEST_STACK[url].fn.shift();fn(data)}}function processData(data){var arr=[];if(data&&data.response&&data.response.docs)for(var items=data.response.docs,i=0;i<items.length;i++){var item=items[i],url=!!(item.url&&Array.isArray(item.url)&&item.url[0])&&item.url[0];if(url){var videoId=function(){var ret=null,sp=url.split("/v/")[1]||!1,v=!!sp&&sp.split("/")[0];return v&&!isNaN(v)&&(ret=v),ret}();videoId&&arr.push(videoId)}}return arr}function processCustomData(data){var arr=[];if(data&&data.channel&&data.channel.item)for(var items=data.channel.item,i=0;i<10;i++){var item=items[i],url=item.link;if(url){var videoId=function(){var ret=null,sp=url.split("/v/")[1]||!1,v=!!sp&&sp.split("/")[0];return v&&!isNaN(v)&&(ret=v),ret}();videoId&&arr.push(videoId)}}return arr}var REQUEST_STACK={};return function(Instance){var opts=Instance.getOpts(),valid=!!(opts&&opts.player&&opts.player.autoadvance&&opts.player.autoadvance.enabled)&&(!opts.app.autoadvance||!(!opts.app.autoadvance||"custom"===opts.app.autoadvance)),playlistId=!!config.autoadvance.playlistId&&config.autoadvance.playlistId;if(valid){var url=config.autoadvance.feed.replace("${domain}",["www",opts&&opts.player&&/foxbusiness/i.test(opts.player.domain)?"foxbusiness":"foxnews","com"].join(".")),index=0,match=null,section="shows"===ISA._meta.section?ISA._meta.raw.subsection1:ISA._meta.section;$.each(playlistId,function(key,value){key===section&&(match=value)}),loadCustomPlaylist(url,match,function(items){Instance.on("amp.advance",function(){var nextVideoId=items[index]||null;Helper.log("playing next video id:",nextVideoId),nextVideoId&&(Instance.change(nextVideoId,{player:{autoplay:!0}}),index++)})})}}});